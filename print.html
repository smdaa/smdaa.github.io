<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="homepage.html"><strong aria-hidden="true">1.</strong> Homepage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cinder-experiments.html"><strong aria-hidden="true">1.1.</strong> Cinder experiments</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cinder-experiments/building_a_dynamic_particle_system/main.html"><strong aria-hidden="true">1.1.1.</strong> Building a Dynamic Particle System</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="homepage"><a class="header" href="#homepage">Homepage</a></h1>
<p>Hi this is the homepage.</p>
<h2 id="topics"><a class="header" href="#topics">Topics:</a></h2>
<ul>
<li><a href="./cinder-experiments.html">Cinder experiments</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cinder-experiments"><a class="header" href="#cinder-experiments">Cinder Experiments</a></h1>
<ul>
<li><a href="./cinder-experiments/building_a_dynamic_particle_system/main.html">Building a Dynamic Particle System</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-a-dynamic-particle-system"><a class="header" href="#building-a-dynamic-particle-system">Building a Dynamic Particle System</a></h1>
<h2 id="creating-a-particle-system"><a class="header" href="#creating-a-particle-system">Creating a particle system</a></h2>
<p>Let's start by creating the particle object. A particle has the following properties: a radius \(r\), a position \((x, y)\), a velocity \((v_x, v_y)\), and an optional color.</p>
<pre><code class="language-C">class Particle {
 public:
  vec2 position;
  vec2 velocity;
  float radius;
  Color color;

  Particle(const vec2 &amp;position, const vec2 &amp;velocity, float radius,
           Color color)
      : position(position), velocity(velocity), radius(radius), color(color) {}

  void draw() {
    gl::color(color);
    gl::drawSolidCircle(position, radius);
  }
  void updateVelocity(vec2 force, float dt) { velocity += force * dt; }
  void updatePosition(float dt) { position += velocity * dt; }
};
</code></pre>
<p>Since we want our particle to remain inside the screen, we will use the factor <strong>WALL_BOUNCE_FACTOR</strong> \(\in [0, 1]\) to bounce the particle in the other way if it leaves the screen.</p>
<pre><code class="language-C">class Particle
{
public:
  vec2 position;
  vec2 velocity;
  float radius;
  Color color;

  ...

  void checkEdgeCollision() {
    if (position.x - radius &lt; 0) {
      position.x = radius;
      velocity.x = -WALL_BOUNCE_FACTOR * velocity.x;
    } else if (position.x + radius &gt; WINDOW_WIDTH) {
      position.x = WINDOW_WIDTH - radius;
      velocity.x = -WALL_BOUNCE_FACTOR * velocity.x;
    }

    if (position.y - radius &lt; 0) {
      position.y = radius;
      velocity.y = -WALL_BOUNCE_FACTOR * velocity.y;
    } else if (position.y + radius &gt; WINDOW_HEIGHT) {
      position.y = WINDOW_HEIGHT - radius;
      velocity.y = -WALL_BOUNCE_FACTOR * velocity.y;
    }
  }
};
</code></pre>
<p>Let's simulate the collision of two particles next. The model is quite basic; it assumes that the two particles have the same mass and that the collision is elastic.</p>
<pre><code class="language-C">class Particle
{
public:
  vec2 position;
  vec2 velocity;
  float radius;
  Color color;

  ...

  void checkParticleCollision(Particle &amp;other) {
    vec2 relativePosition = other.position - position;
    vec2 relativeVelocity = other.velocity - velocity;
    float distance = glm::length(relativePosition);
    float combinedRadius = radius + other.radius;

    if (distance &lt; combinedRadius) {
      // Particles are colliding
      float penetration = combinedRadius - distance;
      vec2 collisionNormal = glm::normalize(relativePosition);
      float relativeVelocityAlongNormal =
          glm::dot(relativeVelocity, collisionNormal);
      if (relativeVelocityAlongNormal &gt; 0) {
        return;
      }
      float j = -relativeVelocityAlongNormal;
      vec2 impulse = j * collisionNormal;
      velocity -= impulse;
      other.velocity += impulse;
      position -= 0.5f * penetration * collisionNormal;
      other.position += 0.5f * penetration * collisionNormal;
    }
  }
};
</code></pre>
<h2 id="creating-a-2d-world"><a class="header" href="#creating-a-2d-world">Creating a 2D world</a></h2>
<p>We will have a list of particles in our environment, and we will need to establish an energy field in order to move them.</p>
<p>Using the <strong>GRID_RESOLUTION</strong> parameter, we will divide our 2D plane into a grid. For each coordinate in the grid \((x_i, y_i)\), we will have an angle pointing in the direction of motion. We'll make the field point in the direction of the mouse to make the experience interactive.</p>
<pre><code class="language-C">class World {
 public:
  float dt;
  int gridNumRows;
  int gridNumCols;
  std::vector&lt;std::vector&lt;float&gt;&gt; grid;
  std::vector&lt;Particle&gt; particles;

  World() {
    dt = DT;
    gridNumRows = WINDOW_HEIGHT / GRID_RESOLUTION;
    gridNumCols = WINDOW_WIDTH / GRID_RESOLUTION;
    grid = std::vector&lt;std::vector&lt;float&gt;&gt;(
        gridNumRows, std::vector&lt;float&gt;(gridNumCols, 0.0f));
    particles = std::vector&lt;Particle&gt;();
  }

  void addParticle(const Particle &amp;particle) { particles.push_back(particle); }

  void updateGrid(const vec2 &amp;mousePos) {
    for (int i = 0; i &lt; gridNumRows; ++i) {
      for (int j = 0; j &lt; gridNumCols; ++j) {
        float x = static_cast&lt;float&gt;(j) * static_cast&lt;float&gt;(GRID_RESOLUTION);
        float y = static_cast&lt;float&gt;(i) * static_cast&lt;float&gt;(GRID_RESOLUTION);

        grid[i][j] = atan2(mousePos.y - y, mousePos.x - x);
      }
    }
  }

};
</code></pre>
<video width="auto" height="auto" controls>
  <source src="grid.webm" type="video/webm">
  Your browser does not support the video tag.
</video>
<p>The process of updating the particles is simple: using the factor <strong>FORCE_FEILD_FACTOR</strong>, each particle is moved towards the angle of the closest point in the 2D grid. To add some variation, the force of movement is proportional to the radius. After that, we look for collisions.</p>
<pre><code class="language-C">class World {
 public:
  float dt;
  int gridNumRows;
  int gridNumCols;
  std::vector&lt;std::vector&lt;float&gt;&gt; grid;
  std::vector&lt;Particle&gt; particles;

  ...

  void updateParticles(float dt) {
    for (int i = 0; i &lt; particles.size(); ++i) {
      int rowIndex = static_cast&lt;int&gt;(std::min(
          std::max(
              particles[i].position.y / static_cast&lt;float&gt;(GRID_RESOLUTION),
              0.0f),
          static_cast&lt;float&gt;(gridNumRows - 1)));
      int columnIndex = static_cast&lt;int&gt;(std::min(
          std::max(
              particles[i].position.x / static_cast&lt;float&gt;(GRID_RESOLUTION),
              0.0f),
          static_cast&lt;float&gt;(gridNumCols - 1)));
      float gridValue = grid[rowIndex][columnIndex];
      vec2 force = FORCE_FEILD_FACTOR * particles[i].radius *
                   vec2(cos(gridValue), sin(gridValue));
      particles[i].updateVelocity(force, dt);
      particles[i].updatePosition(dt);
      for (auto &amp;other : particles) {
        if (&amp;particles[i] != &amp;other) {
          other.checkParticleCollision(particles[i]);
        }
      }
      particles[i].checkEdgeCollision();
    }
  }  
};
</code></pre>
<video width="auto" height="auto" controls>
  <source src="particles.webm" type="video/webm">
  Your browser does not support the video tag.
</video>
<h2 id="drawing"><a class="header" href="#drawing">Drawing</a></h2>
<p>Instead of just drawing the particles let's create a triangular mesh. </p>
<p>The mesh is created by extruding the particle positions along the z-axis and connecting them to form triangles. </p>
<p>The use of alpha blending ensures smooth transitions especially when the number of particles is big.</p>
<pre><code class="language-C">class CollisionApp : public App {
 public:

  ...

  void draw() override {
    if (world.particles.size() &gt; 2) {
      // Create a TriMesh
      TriMesh::Format format = TriMesh::Format().positions(3);
      TriMesh mesh(format);

      // Extrude the path
      float extrusionDepth = 10.0f;
      for (const auto &amp;particle : world.particles) {
        vec3 position(particle.position, 0);
        mesh.appendPosition(position);

        position.z += extrusionDepth;
        mesh.appendPosition(position);
      }

      // Add triangles
      for (size_t i = 0; i &lt; mesh.getNumVertices() - 4; i += 4) {
        mesh.appendTriangle(i, i + 2, i + 4);
        mesh.appendTriangle(i + 1, i + 3, i + 5);
      }

      // Draw the mesh
      gl::color(MESH_COLOR);
      gl::enableAlphaBlending();
      gl::draw(mesh);
      gl::disableAlphaBlending();
    }
  }    

</code></pre>
<h3 id="example-1"><a class="header" href="#example-1">Example 1</a></h3>
<p>The following is an example of the result with a low count of particles:</p>
<video width="auto" height="auto" controls>
  <source src="example1.webm" type="video/webm">
  Your browser does not support the video tag.
</video>
<h3 id="example-2"><a class="header" href="#example-2">Example 2</a></h3>
<p>The following is an example of the result with a high count of particles:</p>
<video width="auto" height="auto" controls>
  <source src="example2.webm" type="video/webm">
  Your browser does not support the video tag.
</video>
<p>you can experiment with the different variables and see what you will get:</p>
<pre><code class="language-C">#define WINDOW_WIDTH 1920
#define WINDOW_HEIGHT 1080
#define NPARTICLES 500
#define MAX_RADIUS 5.0f
#define MIN_RADIUS 1.0f
#define MAX_VELOCITY 0.0f
#define MIN_VELOCITY 0.0f
#define WALL_BOUNCE_FACTOR 0.2f
#define FORCE_FEILD_FACTOR 0.5f
#define DT 0.9f
#define GRID_RESOLUTION 5
#define DRAW_GRID false
#define DRAW_PARTICLES false
#define BG_COLOR Color(0.6f, 0.6f, 0.6f)
#define MESH_COLOR ColorA(0.0f, 0.0f, 0.0f, 0.05f)
</code></pre>
<p><a href="https://github.com/smdaa/creative-coding/blob/main/src/example_1/main.cpp">Full source code</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
